#!/usr/bin/env sh

XDG_CONFIG_HOME=${XDG_CONFIG_HOME:-"$HOME/.config"}
XDG_CACHE_HOME=${XDG_CACHE_HOME:-"$HOME/.cache"}

DIMS="$(xdpyinfo | grep dimensions | awk '{print $2}')"
WALL="$XDG_CONFIG_HOME/i3/wallpaper.png"
OUTDIR="$XDG_CACHE_HOME/i3/wallpapers"
OUT="$OUTDIR/$DIMS.png"

[ -f "$OUT" ] && i3lock -i "$OUT" && sleep 0.3 && xset dpms force off && exit
[ ! -f "$WALL" ] && i3lock -c 142a3a && sleep 0.3 && xset dpms force off && exit
[ ! -d "$OUTDIR" ] && mkdir --parents $OUTDIR
convert -resize "$DIMS^" -gravity center -extent "$DIMS" $WALL $OUT
i3lock -i "$OUT"
sleep 0.3 && xset dpms force off && exit
